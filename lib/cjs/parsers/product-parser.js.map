{"version":3,"sources":["../../../src/parsers/product-parser.ts"],"names":["ProductParser","verbose","console","log","time","buildProducts","jsonLDObject","timeEnd","getTripleCount","tripleCount","getTriples","graph","skippedTypes","IFCOPENINGELEMENT","subTypes","IFCELEMENT","filter","typeID","indexOf","expressIDArray","typeId","push","ifcAPI","properties","getAllItemsOfType","modelID","i","length","expressID","getItemProperties","type","GlobalId","URI","value","IfcElements","Parser"],"mappings":"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","sourcesContent":["import {\r\n    IFCELEMENT,\r\n    IFCOPENINGELEMENT\r\n} from 'web-ifc';\r\n\r\nimport { Parser } from \"./parser\";\r\nimport { JSONLD } from \"../helpers/BaseDefinitions\";\r\nimport { defaultURIBuilder } from \"../helpers/uri-builder\";\r\nimport { IfcElements } from \"../helpers/IfcElementsMap\";\r\nimport { getItemSubtypes } from '../helpers/item-search';\r\n\r\nexport class ProductParser extends Parser{\r\n\r\n    public async doParse(): Promise<JSONLD|string>{\r\n\r\n        this.verbose && console.log(\"Started PRODUCTS parsing\");\r\n        this.verbose && console.log(\"\");\r\n        console.time(\"Finished products parsing\");\r\n\r\n        this.verbose && console.log(\"## STEP 1: CLASS ASSIGNMENT ##\");\r\n        this.verbose && console.time(\"1/1: Finding products\");\r\n        this.jsonLDObject[\"@graph\"] = await this.buildProducts();\r\n        this.verbose && console.timeEnd(\"1/1: Finding products\");\r\n        this.verbose && console.log(\"\");\r\n\r\n        console.timeEnd(\"Finished products parsing\");\r\n\r\n        if(this.verbose){\r\n            const tripleCount = await this.getTripleCount();\r\n            console.log(\"Total triples: \" + tripleCount);\r\n        }\r\n\r\n        return await this.getTriples();\r\n\r\n    }\r\n\r\n    private async buildProducts(): Promise<any[]>{\r\n\r\n        const graph = [];\r\n\r\n        const skippedTypes = [IFCOPENINGELEMENT];\r\n\r\n        // Get all subTypes of IfcElement\r\n        const subTypes: number[] = getItemSubtypes(IFCELEMENT)\r\n            .filter(typeID => skippedTypes.indexOf(typeID) == -1);  // Filter out skipped types\r\n    \r\n\r\n        // Get all items in model that belong to any of these types\r\n        let expressIDArray: number[] = [];\r\n        for(let typeId of subTypes){\r\n            expressIDArray.push(...await this.ifcAPI.properties.getAllItemsOfType(this.modelID, typeId, false));\r\n        }\r\n\r\n        for (let i = 0; i < expressIDArray.length; i++) {\r\n            const expressID = expressIDArray[i];\r\n            \r\n            const {type, GlobalId} = await this.ifcAPI.properties.getItemProperties(this.modelID, expressID);\r\n            const URI = defaultURIBuilder(GlobalId.value);\r\n\r\n            // Push product\r\n            graph.push({\r\n                \"@id\": URI,\r\n                \"@type\": `ifc:${IfcElements[type]}`\r\n            });\r\n            \r\n        }\r\n\r\n        return graph;\r\n\r\n    }\r\n\r\n}"],"file":"product-parser.js"}