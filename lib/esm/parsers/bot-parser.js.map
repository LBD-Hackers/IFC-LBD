{"version":3,"sources":["../../../src/parsers/bot-parser.ts"],"names":["BOTParser","Parser","doParse","verbose","console","log","time","jsonLDObject","push","buildSites","timeEnd","buildBuildings","buildStoreys","buildSpaces","buildElements","buildSpaceAdjacentElementRelationships","buildSpaceContainedElementRelationships","buildStoreyElementRelationships","buildHostedElementRelationships","buildStoreySpaceRelationships","buildBuildingStoreyRelationships","buildSiteBuildingRelationships","tripleCount","getTripleCount","getTriples","ifcAPI","modelID","IFCSITE","IFCBUILDING","IFCBUILDINGSTOREY","IFCSPACE","includeSubTypes","IFCELEMENT","subjectRef","targetRef","rdfRelationship","IFCRELSPACEBOUNDARY","subjectClass","IFCRELCONTAINEDINSPATIALSTRUCTURE","IFCRELVOIDSELEMENT","targetClass","IFCRELAGGREGATES"],"mappings":"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","sourcesContent":["import { buildRelOneToMany, buildRelOneToOne } from \"../helpers/path-search\";\n\nimport {\n    IFCRELSPACEBOUNDARY,\n    IFCRELCONTAINEDINSPATIALSTRUCTURE,\n    IFCRELVOIDSELEMENT,\n    IFCRELAGGREGATES,\n    IFCBUILDING,\n    IFCSITE,\n    IFCBUILDINGSTOREY,\n    IFCSPACE,\n    IFCELEMENT\n} from 'web-ifc';\nimport { buildClassInstances } from \"../helpers/class-assignment\";\nimport { Parser } from \"./parser\";\nimport { JSONLD } from \"../helpers/BaseDefinitions\";\n\nexport class BOTParser extends Parser{\n\n    public async doParse(): Promise<JSONLD|string>{\n\n        this.verbose && console.log(\"Started BOT parsing\");\n        this.verbose && console.log(\"\");\n        console.time(\"Finished BOT parsing\");\n\n        // Class assignment\n        this.verbose && console.log(\"## STEP 1: CLASS ASSIGNMENT ##\");\n        this.verbose && console.time(\"1/12: Finding sites\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildSites()));\n        this.verbose && console.timeEnd(\"1/12: Finding sites\");\n        this.verbose && console.time(\"2/12: Finding buildings\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildBuildings()));\n        this.verbose && console.timeEnd(\"2/12: Finding buildings\");\n        this.verbose && console.time(\"3/12: Finding storeys\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildStoreys()));\n        this.verbose && console.timeEnd(\"3/12: Finding storeys\");\n        this.verbose && console.time(\"4/12: Finding spaces\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildSpaces()));\n        this.verbose && console.timeEnd(\"4/12: Finding spaces\");\n        this.verbose && console.time(\"5/12: Finding elements\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildElements()));\n        this.verbose && console.timeEnd(\"5/12: Finding elements\");\n        this.verbose && console.log(\"\");\n\n        // Space-Element relationships\n        this.verbose && console.log(\"## STEP 2: SPACE-ELEMENT RELATIONSHIPS ##\");\n        this.verbose && console.time(\"6/12: Finding spaces' adjacent elements\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildSpaceAdjacentElementRelationships()));\n        this.verbose && console.timeEnd(\"6/12: Finding spaces' adjacent elements\");\n        this.verbose && console.time(\"7/12: Finding spaces' contained elements\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildSpaceContainedElementRelationships()));\n        this.verbose && console.timeEnd(\"7/12: Finding spaces' contained elements\");\n        this.verbose && console.time(\"8/12: Finding storeys' elements\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildStoreyElementRelationships()));\n        this.verbose && console.timeEnd(\"8/12: Finding storeys' elements\");\n        this.verbose && console.log(\"\");\n\n        // Element-element relationships\n        this.verbose && console.log(\"## STEP 3: ELEMENT-ELEMENT RELATIONSHIPS ##\");\n        this.verbose && console.time(\"9/12: Finding elements' hosted elements\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildHostedElementRelationships()));\n        this.verbose && console.timeEnd(\"9/12: Finding elements' hosted elements\");\n        this.verbose && console.log(\"\");\n\n        // Zone containment\n        this.verbose && console.log(\"## STEP 4: ZONE-ZONE RELATIONSHIPS ##\");\n        this.verbose && console.time(\"10/12: Finding storeys' spaces\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildStoreySpaceRelationships()));\n        this.verbose && console.timeEnd(\"10/12: Finding storeys' spaces\");\n        this.verbose && console.time(\"11/12: Finding buildings' storeys\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildBuildingStoreyRelationships()));\n        this.verbose && console.timeEnd(\"11/12: Finding buildings' storeys\");\n        this.verbose && console.time(\"12/12: Finding sties' buildings\");\n        this.jsonLDObject[\"@graph\"].push(...(await this.buildSiteBuildingRelationships()));\n        this.verbose && console.timeEnd(\"12/12: Finding sties' buildings\");\n        this.verbose && console.log(\"\");\n\n        console.timeEnd(\"Finished BOT parsing\");\n\n        if(this.verbose){\n            const tripleCount = await this.getTripleCount();\n            console.log(\"Total triples: \" + tripleCount);\n        }\n\n        return await this.getTriples();\n\n    }\n\n    /**\n     * CLASS ASSIGNMENT\n     */\n     private async buildSites(): Promise<any[]>{\n        return await buildClassInstances(this.ifcAPI, this.modelID, IFCSITE, [\"bot:Site\"]);\n    }\n    private async buildBuildings(): Promise<any[]>{\n        return await buildClassInstances(this.ifcAPI, this.modelID, IFCBUILDING, [\"bot:Building\"]);\n    }\n    private async buildStoreys(): Promise<any[]>{\n        return await buildClassInstances(this.ifcAPI, this.modelID, IFCBUILDINGSTOREY, [\"bot:Storey\"]);\n    }\n    private async buildSpaces(): Promise<any[]>{\n        return await buildClassInstances(this.ifcAPI, this.modelID, IFCSPACE, [\"bot:Space\"]);\n    }\n    private async buildElements(): Promise<any[]>{\n        const includeSubTypes: boolean = true;\n        return await buildClassInstances(this.ifcAPI, this.modelID, IFCELEMENT, [\"bot:Element\"], includeSubTypes);\n    }\n\n    /**\n     * ZONE-ELEMENT-RELATIONSHIPS\n     */\n    private async buildSpaceAdjacentElementRelationships(): Promise<any[]>{\n        const subjectRef = \"RelatingSpace\";\n        const targetRef = \"RelatedBuildingElement\";\n        const rdfRelationship = \"bot:adjacentElement\";\n        return await buildRelOneToOne(this.ifcAPI, this.modelID, IFCRELSPACEBOUNDARY, subjectRef, targetRef, rdfRelationship, true);\n    }\n\n    private async buildSpaceContainedElementRelationships(): Promise<any[]>{\n        const subjectRef = \"RelatingStructure\";\n        const targetRef = \"RelatedElements\";\n        const rdfRelationship = \"bot:containsElement\";\n        const subjectClass = IFCSPACE;\n        return await buildRelOneToMany(this.ifcAPI, this.modelID, IFCRELCONTAINEDINSPATIALSTRUCTURE, subjectRef, targetRef, rdfRelationship, subjectClass);\n    }\n\n    private async buildStoreyElementRelationships(): Promise<any[]>{\n        const subjectRef = \"RelatingStructure\";\n        const targetRef = \"RelatedElements\";\n        const rdfRelationship = \"bot:hasElement\";\n        const subjectClass = IFCBUILDINGSTOREY;\n        return await buildRelOneToMany(this.ifcAPI, this.modelID, IFCRELCONTAINEDINSPATIALSTRUCTURE, subjectRef, targetRef, rdfRelationship, subjectClass);\n    }\n\n    /**\n     * ELEMENT-ELEMENT-RELATIONSHIPS\n     */\n     private async buildHostedElementRelationships(): Promise<any[]>{\n        const subjectRef = \"RelatingBuildingElement\";\n        const targetRef = \"RelatedOpeningElement\";\n        const rdfRelationship = \"bot:hasSubElement\";\n        return await buildRelOneToOne(this.ifcAPI, this.modelID, IFCRELVOIDSELEMENT, subjectRef, targetRef, rdfRelationship);\n    }\n\n    /**\n     * ZONE-CONTAINMENT\n     */\n    private async buildStoreySpaceRelationships(): Promise<any[]>{\n        const subjectRef = \"RelatingObject\";\n        const targetRef = \"RelatedObjects\";\n        const rdfRelationship = \"bot:hasSpace\";\n        const subjectClass = IFCBUILDINGSTOREY;\n        const targetClass = IFCSPACE;\n        return await buildRelOneToMany(this.ifcAPI, this.modelID, IFCRELAGGREGATES, subjectRef, targetRef, rdfRelationship, subjectClass, targetClass);\n    }\n\n    private async buildBuildingStoreyRelationships(): Promise<any[]>{\n        const subjectRef = \"RelatingObject\";\n        const targetRef = \"RelatedObjects\";\n        const rdfRelationship = \"bot:hasStorey\";\n        const subjectClass = IFCBUILDING;\n        const targetClass = IFCBUILDINGSTOREY;\n        return await buildRelOneToMany(this.ifcAPI, this.modelID, IFCRELAGGREGATES, subjectRef, targetRef, rdfRelationship, subjectClass, targetClass);\n    }\n\n    private async buildSiteBuildingRelationships(): Promise<any[]>{\n        const subjectRef = \"RelatingObject\";\n        const targetRef = \"RelatedObjects\";\n        const rdfRelationship = \"bot:hasBuilding\";\n        const subjectClass = IFCSITE;\n        const targetClass = IFCBUILDING;\n        return await buildRelOneToMany(this.ifcAPI, this.modelID, IFCRELAGGREGATES, subjectRef, targetRef, rdfRelationship, subjectClass, targetClass);\n    }\n\n}"],"file":"bot-parser.js"}